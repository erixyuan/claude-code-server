# æ—¥å¿—è¾“å‡ºç¤ºä¾‹

æœ¬æ–‡æ¡£å±•ç¤ºäº†å¢å¼ºåçš„æ—¥å¿—è¾“å‡ºï¼Œå¸®åŠ©ä½ ç†è§£ç³»ç»Ÿçš„è¿è¡Œæµç¨‹ã€‚

## åœºæ™¯ 1: å•æ¡æ¶ˆæ¯å¤„ç†ï¼ˆæ— é˜²æŠ–ï¼‰

### å®¢æˆ·ç«¯è¯·æ±‚
```python
POST /chat/async
{
  "message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±",
  "user_id": "user123",
  "enable_debounce": false
}
```

### æ—¥å¿—è¾“å‡º
```
================================================================================
ğŸ¯ åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
================================================================================
ğŸ“‹ Task ID: 550e8400-e29b-41d4-a716-446655440000
ğŸ‘¤ User ID: user123
ğŸ”‘ Session ID: user_user123
ğŸ“ æ¶ˆæ¯å†…å®¹: ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ğŸ“ æ¶ˆæ¯é•¿åº¦: 12 å­—ç¬¦
================================================================================
â–¶ï¸  å¼€å§‹æ‰§è¡Œä»»åŠ¡ 550e8400-e29b-41d4-a716-446655440000
================================================================================
ğŸ“¥ Agent æ”¶åˆ°æ¶ˆæ¯
================================================================================
ğŸ‘¤ User ID: user123
ğŸ”‘ Session ID: user_user123
ğŸ“ åŸå§‹æ¶ˆæ¯: ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
âœï¸  æ ¼å¼åŒ–å: ä»¥ä¸‹æ˜¯user_id=user123å‘è¿‡æ¥çš„é£ä¹¦æ¶ˆæ¯: ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ğŸ“¤ å‘é€ç»™ Claude Client...
================================================================================
ğŸš€ è°ƒç”¨ Claude Agent SDK
================================================================================
ğŸ“ ç”¨æˆ· Query: ä»¥ä¸‹æ˜¯user_id=user123å‘è¿‡æ¥çš„é£ä¹¦æ¶ˆæ¯: ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ğŸ”‘ Claude Session ID: æ–°ä¼šè¯
ğŸ“‚ å·¥ä½œç›®å½•: /Users/ericyuan/Project/viralt/viralt-pocket-manager-cc
âš™ï¸  é…ç½®é€‰é¡¹: model=claude-sonnet-4-5-20250929, timeout=300s
â³ ç­‰å¾… Claude å“åº”...
âœ… Claude å“åº”å®Œæˆï¼Œå†…å®¹é•¿åº¦: 245 å­—ç¬¦
================================================================================
ğŸ’¾ å·²ä¿å­˜å¯¹è¯å†å²
âœ… Agent å¤„ç†å®Œæˆ
================================================================================
âœ… ä»»åŠ¡ 550e8400-e29b-41d4-a716-446655440000 æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: 3.45s
```

---

## åœºæ™¯ 2: æ¶ˆæ¯é˜²æŠ–åˆå¹¶ï¼ˆ3æ¡æ¶ˆæ¯ï¼‰

### å®¢æˆ·ç«¯è¯·æ±‚åºåˆ—
```python
# T+0.0s
POST /chat/async
{
  "message": "ä½ å¥½",
  "user_id": "user123",
  "enable_debounce": true,
  "debounce_window": 5.0
}

# T+1.0s
POST /chat/async
{
  "message": "æˆ‘å« Eric",
  "user_id": "user123",
  "enable_debounce": true,
  "debounce_window": 5.0
}

# T+2.0s
POST /chat/async
{
  "message": "è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±",
  "user_id": "user123",
  "enable_debounce": true,
  "debounce_window": 5.0
}
```

### æ—¥å¿—è¾“å‡º
```
# ===== ç¬¬ä¸€æ¡æ¶ˆæ¯åˆ°è¾¾ =====
2025-11-16 14:00:00 | INFO     | claude_code_server_api.message_buffer:add_message:92 - ğŸ“ Message buffered for session user_user123: 'ä½ å¥½...' (total: 1 messages)
2025-11-16 14:00:00 | DEBUG    | claude_code_server_api.message_buffer:add_message:106 - â±ï¸  Started 5.0s debounce timer for session user_user123
2025-11-16 14:00:00 | DEBUG    | claude_code_server_api.message_buffer:_debounce_timer:122 - â³ Waiting 5.0s for session user_user123...

# ===== ç¬¬äºŒæ¡æ¶ˆæ¯åˆ°è¾¾ï¼ˆ1ç§’åï¼‰=====
2025-11-16 14:00:01 | INFO     | claude_code_server_api.message_buffer:add_message:92 - ğŸ“ Message buffered for session user_user123: 'æˆ‘å« Eric...' (total: 2 messages)
2025-11-16 14:00:01 | DEBUG    | claude_code_server_api.message_buffer:add_message:100 - â±ï¸  Cancelled existing timer for session user_user123
2025-11-16 14:00:01 | DEBUG    | claude_code_server_api.message_buffer:add_message:106 - â±ï¸  Started 5.0s debounce timer for session user_user123
2025-11-16 14:00:01 | DEBUG    | claude_code_server_api.message_buffer:_debounce_timer:130 - â±ï¸  Timer cancelled for session user_user123

# ===== ç¬¬ä¸‰æ¡æ¶ˆæ¯åˆ°è¾¾ï¼ˆ2ç§’åï¼‰=====
2025-11-16 14:00:02 | INFO     | claude_code_server_api.message_buffer:add_message:92 - ğŸ“ Message buffered for session user_user123: 'è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±...' (total: 3 messages)
2025-11-16 14:00:02 | DEBUG    | claude_code_server_api.message_buffer:add_message:100 - â±ï¸  Cancelled existing timer for session user_user123
2025-11-16 14:00:02 | DEBUG    | claude_code_server_api.message_buffer:add_message:106 - â±ï¸  Started 5.0s debounce timer for session user_user123
2025-11-16 14:00:02 | DEBUG    | claude_code_server_api.message_buffer:_debounce_timer:130 - â±ï¸  Timer cancelled for session user_user123

# ===== 5ç§’åè®¡æ—¶å™¨åˆ°æœŸï¼Œåˆå¹¶æ¶ˆæ¯ =====
2025-11-16 14:00:07 | INFO     | claude_code_server_api.message_buffer:_flush:166 - ğŸ”„ Flushing 3 message(s) for session user_user123
2025-11-16 14:00:07 | DEBUG    | claude_code_server_api.message_buffer:_flush:169 -    Combined message: 'ä½ å¥½
æˆ‘å« Eric
è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±...'
2025-11-16 14:00:07 | DEBUG    | claude_code_server_api.message_buffer:_flush:178 - âœ… Callback completed for session user_user123

# ===== åˆ›å»ºä»»åŠ¡å¤„ç†åˆå¹¶åçš„æ¶ˆæ¯ =====
================================================================================
ğŸ¯ åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
================================================================================
ğŸ“‹ Task ID: abc123-def4-56gh-7890-ijklmnopqrst
ğŸ‘¤ User ID: user123
ğŸ”‘ Session ID: user_user123
ğŸ“ æ¶ˆæ¯å†…å®¹: ä½ å¥½
æˆ‘å« Eric
è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ğŸ“ æ¶ˆæ¯é•¿åº¦: 24 å­—ç¬¦
ğŸ”„ æ£€æµ‹åˆ°åˆå¹¶æ¶ˆæ¯ï¼ŒåŒ…å« 3 éƒ¨åˆ†:
   1. ä½ å¥½
   2. æˆ‘å« Eric
   3. è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
================================================================================
â–¶ï¸  å¼€å§‹æ‰§è¡Œä»»åŠ¡ abc123-def4-56gh-7890-ijklmnopqrst

================================================================================
ğŸ“¥ Agent æ”¶åˆ°æ¶ˆæ¯
================================================================================
ğŸ‘¤ User ID: user123
ğŸ”‘ Session ID: user_user123
ğŸ“ åŸå§‹æ¶ˆæ¯: ä½ å¥½
æˆ‘å« Eric
è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
âœï¸  æ ¼å¼åŒ–å: ä»¥ä¸‹æ˜¯user_id=user123å‘è¿‡æ¥çš„é£ä¹¦æ¶ˆæ¯: ä½ å¥½
æˆ‘å« Eric
è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ğŸ“¤ å‘é€ç»™ Claude Client...

================================================================================
ğŸš€ è°ƒç”¨ Claude Agent SDK
================================================================================
ğŸ“ ç”¨æˆ· Query: ä»¥ä¸‹æ˜¯user_id=user123å‘è¿‡æ¥çš„é£ä¹¦æ¶ˆæ¯: ä½ å¥½
æˆ‘å« Eric
è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ğŸ”‘ Claude Session ID: æ–°ä¼šè¯
ğŸ“‚ å·¥ä½œç›®å½•: /Users/ericyuan/Project/viralt/viralt-pocket-manager-cc
âš™ï¸  é…ç½®é€‰é¡¹: model=claude-sonnet-4-5-20250929, timeout=300s
â³ ç­‰å¾… Claude å“åº”...
âœ… Claude å“åº”å®Œæˆï¼Œå†…å®¹é•¿åº¦: 312 å­—ç¬¦
================================================================================
ğŸ’¾ å·²ä¿å­˜å¯¹è¯å†å²
âœ… Agent å¤„ç†å®Œæˆ
================================================================================
âœ… ä»»åŠ¡ abc123-def4-56gh-7890-ijklmnopqrst æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: 4.23s
```

---

## åœºæ™¯ 3: DEBUG çº§åˆ«æ—¥å¿—ï¼ˆæ›´è¯¦ç»†ï¼‰

å¯ç”¨ DEBUG çº§åˆ«åï¼ˆ`config.yaml` ä¸­è®¾ç½® `logging.level: "DEBUG"`ï¼‰ï¼Œä¼šçœ‹åˆ°æ›´å¤šç»†èŠ‚ï¼š

```
# ... å‰é¢çš„æ—¥å¿— ...

================================================================================
ğŸš€ è°ƒç”¨ Claude Agent SDK
================================================================================
ğŸ“ ç”¨æˆ· Query: ä»¥ä¸‹æ˜¯user_id=user123å‘è¿‡æ¥çš„é£ä¹¦æ¶ˆæ¯: ä½ å¥½ï¼Œä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
ğŸ”‘ Claude Session ID: 550e8400-1234-5678-abcd-ef0123456789
ğŸ“‚ å·¥ä½œç›®å½•: /Users/ericyuan/Project/viralt/viralt-pocket-manager-cc
âš™ï¸  é…ç½®é€‰é¡¹: model=claude-sonnet-4-5-20250929, timeout=300s
â³ ç­‰å¾… Claude å“åº”...

# ===== DEBUG çº§åˆ«ï¼šSDK è¿”å›çš„æ¶ˆæ¯ =====
2025-11-16 14:00:10 | DEBUG    | claude_code_server.client:_run_query:114 - ğŸ“¨ SDK æ¶ˆæ¯ #1: SystemMessage
2025-11-16 14:00:10 | DEBUG    | claude_code_server.client:_run_query:114 - ğŸ“¨ SDK æ¶ˆæ¯ #2: AssistantMessage
2025-11-16 14:00:10 | DEBUG    | claude_code_server.client:_run_query:121 -    ğŸ’¬ å†…å®¹é¢„è§ˆ: ä½ å¥½ Ericï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚æˆ‘æ˜¯ Claudeï¼Œä¸€ä¸ªç”± Anthropic å¼€å‘çš„ AI åŠ©æ‰‹ã€‚æˆ‘çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š

1. æˆ‘èƒ½å¤Ÿè¿›è¡Œæ·±å…¥çš„å¯¹è¯ï¼Œç†è§£ä¸Šä¸‹æ–‡...
2025-11-16 14:00:10 | DEBUG    | claude_code_server.client:_run_query:114 - ğŸ“¨ SDK æ¶ˆæ¯ #3: ResultMessage

âœ… Claude å“åº”å®Œæˆï¼Œå†…å®¹é•¿åº¦: 312 å­—ç¬¦
================================================================================

2025-11-16 14:00:10 | DEBUG    | claude_code_server.agent:chat:98 - ğŸ”„ æ›´æ–° Claude Session ID: 550e8400-1234-5678-abcd-ef0123456789
ğŸ’¾ å·²ä¿å­˜å¯¹è¯å†å²
âœ… Agent å¤„ç†å®Œæˆ
================================================================================
```

---

## æ—¥å¿—çº§åˆ«å¯¹æ¯”

### INFO çº§åˆ«ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… æ˜¾ç¤ºå…³é”®ä¸šåŠ¡æµç¨‹
- âœ… ç”¨æˆ·æ¶ˆæ¯å’Œå“åº”
- âœ… ä»»åŠ¡åˆ›å»ºå’Œå®Œæˆ
- âœ… æ¶ˆæ¯åˆå¹¶ä¿¡æ¯
- âŒ ä¸æ˜¾ç¤º SDK å†…éƒ¨ç»†èŠ‚

### DEBUG çº§åˆ«ï¼ˆæ¨èå¼€å‘/è°ƒè¯•ï¼‰
- âœ… åŒ…å« INFO çº§åˆ«çš„æ‰€æœ‰å†…å®¹
- âœ… SDK è¿”å›çš„æ¯æ¡æ¶ˆæ¯
- âœ… æ¶ˆæ¯å†…å®¹é¢„è§ˆ
- âœ… Session ID æ›´æ–°
- âœ… è®¡æ—¶å™¨çŠ¶æ€å˜åŒ–

---

## å…³é”®æ—¥å¿—æ ‡è¯†

| Emoji | å«ä¹‰ | ç¤ºä¾‹ |
|-------|------|------|
| ğŸ¯ | åˆ›å»ºä»»åŠ¡ | `ğŸ¯ åˆ›å»ºå¼‚æ­¥ä»»åŠ¡` |
| ğŸ“¥ | Agent æ”¶åˆ°æ¶ˆæ¯ | `ğŸ“¥ Agent æ”¶åˆ°æ¶ˆæ¯` |
| ğŸ“ | æ¶ˆæ¯å†…å®¹ | `ğŸ“ åŸå§‹æ¶ˆæ¯: ...` |
| âœï¸ | æ¶ˆæ¯æ ¼å¼åŒ– | `âœï¸  æ ¼å¼åŒ–å: ...` |
| ğŸš€ | è°ƒç”¨ SDK | `ğŸš€ è°ƒç”¨ Claude Agent SDK` |
| â³ | ç­‰å¾…ä¸­ | `â³ ç­‰å¾… Claude å“åº”...` |
| âœ… | æˆåŠŸ | `âœ… ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ` |
| âŒ | å¤±è´¥ | `âŒ ä»»åŠ¡æ‰§è¡Œå¤±è´¥` |
| ğŸ“¨ | SDK æ¶ˆæ¯ | `ğŸ“¨ SDK æ¶ˆæ¯ #1` |
| ğŸ’¬ | å†…å®¹é¢„è§ˆ | `ğŸ’¬ å†…å®¹é¢„è§ˆ: ...` |
| ğŸ”„ | åˆå¹¶/æ›´æ–° | `ğŸ”„ æ£€æµ‹åˆ°åˆå¹¶æ¶ˆæ¯` |
| ğŸ’¾ | ä¿å­˜æ•°æ® | `ğŸ’¾ å·²ä¿å­˜å¯¹è¯å†å²` |
| â±ï¸ | è®¡æ—¶å™¨ | `â±ï¸  Started 5.0s debounce timer` |
| ğŸ” | æ£€æŸ¥/æŸ¥æ‰¾ | `ğŸ” æ”¶åˆ°æ¶ˆæ¯` |
| ğŸ‘¤ | ç”¨æˆ· | `ğŸ‘¤ User ID: user123` |
| ğŸ”‘ | Session | `ğŸ”‘ Session ID: ...` |
| ğŸ“‚ | ç›®å½• | `ğŸ“‚ å·¥ä½œç›®å½•: ...` |
| âš™ï¸ | é…ç½® | `âš™ï¸  é…ç½®é€‰é¡¹: ...` |
| ğŸ“ | é•¿åº¦/ç»Ÿè®¡ | `ğŸ“ æ¶ˆæ¯é•¿åº¦: 24 å­—ç¬¦` |
| â–¶ï¸ | å¼€å§‹æ‰§è¡Œ | `â–¶ï¸  å¼€å§‹æ‰§è¡Œä»»åŠ¡` |

---

## é…ç½®æ—¥å¿—çº§åˆ«

åœ¨ `config.yaml` ä¸­ä¿®æ”¹ï¼š

```yaml
logging:
  level: "INFO"   # æˆ– "DEBUG"
  console_output: true
  file_output: true
  file_path: "logs/app_{time:YYYY-MM-DD}.log"
```

---

## å®æ—¶æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆæ§åˆ¶å°ï¼‰
claude-code-server --config config.yaml

# æŸ¥çœ‹æ–‡ä»¶æ—¥å¿—
tail -f logs/app_2025-11-16.log

# åªçœ‹ INFO çº§åˆ«
tail -f logs/app_2025-11-16.log | grep "INFO"

# åªçœ‹ç”¨æˆ· Query
tail -f logs/app_2025-11-16.log | grep "ç”¨æˆ· Query"

# åªçœ‹åˆå¹¶æ¶ˆæ¯
tail -f logs/app_2025-11-16.log | grep "åˆå¹¶æ¶ˆæ¯"
```

---

## æ—¥å¿—æ–‡ä»¶ç¤ºä¾‹

æ–‡ä»¶æ—¥å¿—åŒ…å«æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆè¡Œå·ã€å‡½æ•°åç­‰ï¼‰ï¼š

```
2025-11-16 14:00:00 | INFO     | claude_code_server_api.tasks:create_task:44 - ================================================================================
2025-11-16 14:00:00 | INFO     | claude_code_server_api.tasks:create_task:45 - ğŸ¯ åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
2025-11-16 14:00:00 | INFO     | claude_code_server_api.tasks:create_task:46 - ================================================================================
2025-11-16 14:00:00 | INFO     | claude_code_server_api.tasks:create_task:47 - ğŸ“‹ Task ID: 550e8400-e29b-41d4-a716-446655440000
2025-11-16 14:00:00 | INFO     | claude_code_server_api.tasks:create_task:48 - ğŸ‘¤ User ID: user123
2025-11-16 14:00:00 | INFO     | claude_code_server_api.tasks:create_task:49 - ğŸ”‘ Session ID: user_user123
2025-11-16 14:00:00 | INFO     | claude_code_server_api.tasks:create_task:50 - ğŸ“ æ¶ˆæ¯å†…å®¹: ä½ å¥½
```

æ³¨æ„æ¯è¡ŒåŒ…å«ï¼š
- æ—¶é—´æˆ³ï¼š`2025-11-16 14:00:00`
- çº§åˆ«ï¼š`INFO`
- æ¨¡å—ï¼š`claude_code_server_api.tasks`
- å‡½æ•°ï¼š`create_task`
- è¡Œå·ï¼š`44`
- æ¶ˆæ¯ï¼š`================...`

è¿™å¯¹äºè¿½è¸ªé—®é¢˜éå¸¸æœ‰å¸®åŠ©ï¼
